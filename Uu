import requests

def get_employee_info(data, standard_id_field, cookie_header, standard_ids):
    direct_reports_field = 'allDirectReports'
    is_manager_field = 'is_Manager'
    standard_id_field_value = data[standard_id_field]

    direct_reports = data[direct_reports_field]
    employee_count = len(direct_reports)

    for report in direct_reports:
        if report[is_manager_field] == 1:
            sub_data = get_data_for_standard_id(report[standard_id_field], cookie_header)
            employee_count += get_employee_info(sub_data, standard_id_field, cookie_header, standard_ids)
        else:
            standard_ids.append(report[standard_id_field])

    return employee_count

def get_data_for_standard_id(standard_id, cookie_header):
    url = f'https://example.com/api/v1/orgChart?standardId={standard_id}'
    headers = {
        'cookie': cookie_header,
        'accept-encoding': 'gzip, deflate, br'
    }
    response = requests.get(url, headers=headers)
    data = response.json

